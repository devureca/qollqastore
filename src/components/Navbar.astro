---
import type { Config } from "../types";
import {
    IconInstagram,
    IconFacebook,
    IconTiktok,
    IconSun,
    IconMoon,
} from "../lib/icons";

interface Props {
    config: Config;
}

const { config } = Astro.props;
---

<header
    class="sticky top-0 z-50 border-b"
    style="background: var(--bg); border-color: var(--border);"
>
    <div
        class="max-w-7xl mx-auto px-[5%] flex items-center justify-between h-16"
    >
        <!-- Logo -->
        <a
            href="/"
            class="text-3xl tracking-widest font-bold"
            style="font-family: var(--font-display); color: var(--color-primary);"
        >
            {config.nombre}
        </a>

        <!-- Links centro — solo desktop -->
        <nav class="hidden md:flex items-center gap-8">
            <a
                href="/"
                class="nav-link text-sm font-semibold transition-colors duration-200"
                style="color: var(--text-muted);">Inicio</a
            >
            <a
                href="/#novedades"
                class="nav-link text-sm font-semibold transition-colors duration-200"
                style="color: var(--text-muted);">Novedades</a
            >
            <a
                href="/#ofertas"
                class="nav-link text-sm font-semibold transition-colors duration-200"
                style="color: var(--text-muted);">Ofertas</a
            >
            <a
                href="/catalogo"
                class="nav-link text-sm font-semibold transition-colors duration-200"
                style="color: var(--text-muted);">Catálogo</a
            >
        </nav>

        <!-- Derecha: redes + darkmode + hamburguesa -->
        <div class="flex items-center gap-3">
            <!-- Redes — solo desktop -->
            <div class="hidden md:flex items-center gap-3">
                {
                    config.instagram && (
                        <a
                            href={config.instagram}
                            target="_blank"
                            class="icon-link transition-colors duration-200"
                            aria-label="Instagram"
                            style="color: var(--text-muted);"
                            set:html={IconInstagram}
                        />
                    )
                }
                {
                    config.facebook && (
                        <a
                            href={config.facebook}
                            target="_blank"
                            class="icon-link transition-colors duration-200"
                            aria-label="Facebook"
                            style="color: var(--text-muted);"
                            set:html={IconFacebook}
                        />
                    )
                }
                {
                    config.tiktok && (
                        <a
                            href={`https://tiktok.com/@${config.tiktok}`}
                            target="_blank"
                            class="icon-link transition-colors duration-200"
                            aria-label="TikTok"
                            style="color: var(--text-muted);"
                            set:html={IconTiktok}
                        />
                    )
                }
            </div>

            <!-- Dark mode toggle — siempre visible -->
            <button
                id="darkmode-btn"
                aria-label="Toggle dark mode"
                class="flex items-center justify-center w-9 h-9 rounded-lg border transition-all duration-200"
                style="border-color: var(--border); color: var(--text-muted); background: none;"
            >
                <span id="icon-sun" style="display:none;" set:html={IconSun} />
                <span id="icon-moon" set:html={IconMoon} />
            </button>

            <!-- Hamburguesa — solo mobile -->
            <button
                id="menu-btn"
                aria-label="Abrir menú"
                class="flex md:hidden flex-col items-center justify-center w-9 h-9 gap-1.5 rounded-lg border transition-all duration-200"
                style="border-color: var(--border); background: none; cursor: pointer;"
            >
                <span
                    class="hamburger-line block w-5 h-0.5 transition-all duration-300"
                    style="background: var(--text-muted);"></span>
                <span
                    class="hamburger-line block w-5 h-0.5 transition-all duration-300"
                    style="background: var(--text-muted);"></span>
                <span
                    class="hamburger-line block w-5 h-0.5 transition-all duration-300"
                    style="background: var(--text-muted);"></span>
            </button>
        </div>
    </div>

    <!-- Menú mobile -->
    <div
        id="mobile-menu"
        class="hidden md:hidden border-t px-[5%] py-6 flex-col gap-6"
        style="background: var(--bg); border-color: var(--border);"
    >
        <!-- Links -->
        <nav class="flex flex-col gap-3">
            <a
                href="/"
                class="nav-link text-lg font-semibold transition-colors duration-200"
                style="color: var(--text-muted);">Inicio</a
            >
            <a
                href="/#novedades"
                class="nav-link text-lg font-semibold transition-colors duration-200"
                style="color: var(--text-muted);">Novedades</a
            >
            <a
                href="/#ofertas"
                class="nav-link text-lg font-semibold transition-colors duration-200"
                style="color: var(--text-muted);">Ofertas</a
            >
            <a
                href="/catalogo"
                class="nav-link text-lg font-semibold transition-colors duration-200"
                style="color: var(--text-muted);">Catálogo</a
            >
        </nav>

        <!-- Redes sociales -->
        <div
            class="flex items-center gap-4 pt-3 border-t"
            style="border-color: var(--border);"
        >
            {
                config.instagram && (
                    <a
                        href={config.instagram}
                        target="_blank"
                        class="icon-link transition-colors duration-200"
                        aria-label="Instagram"
                        style="color: var(--text-muted);"
                        set:html={IconInstagram}
                    />
                )
            }
            {
                config.facebook && (
                    <a
                        href={config.facebook}
                        target="_blank"
                        class="icon-link transition-colors duration-200"
                        aria-label="Facebook"
                        style="color: var(--text-muted);"
                        set:html={IconFacebook}
                    />
                )
            }
            {
                config.tiktok && (
                    <a
                        href={`https://tiktok.com/@${config.tiktok}`}
                        target="_blank"
                        class="icon-link transition-colors duration-200"
                        aria-label="TikTok"
                        style="color: var(--text-muted);"
                        set:html={IconTiktok}
                    />
                )
            }
        </div>
    </div>
</header>

<style>
    .nav-link:hover {
        color: var(--color-primary) !important;
    }
    .icon-link:hover {
        color: var(--color-primary) !important;
    }
</style>

<script>
    // Dark mode
    const btn = document.getElementById("darkmode-btn")!;
    const iconSun = document.getElementById("icon-sun")!;
    const iconMoon = document.getElementById("icon-moon")!;

    function applyTheme(dark: boolean) {
        document.documentElement.setAttribute(
            "data-theme",
            dark ? "dark" : "light",
        );
        iconSun.style.display = dark ? "flex" : "none";
        iconMoon.style.display = dark ? "none" : "flex";
        localStorage.setItem("theme", dark ? "dark" : "light");
    }

    const saved = localStorage.getItem("theme");
    applyTheme(saved ? saved === "dark" : false);

    btn.addEventListener("click", () => {
        const isDark =
            document.documentElement.getAttribute("data-theme") === "dark";
        applyTheme(!isDark);
    });

    // Hamburguesa
    const menuBtn = document.getElementById("menu-btn")!;
    const mobileMenu = document.getElementById("mobile-menu")!;
    const lines = menuBtn.querySelectorAll(".hamburger-line");
    let open = false;

    menuBtn.addEventListener("click", () => {
        open = !open;
        mobileMenu.classList.toggle("hidden", !open);

        // Animación X
        if (open) {
            (lines[0] as HTMLElement).style.transform =
                "translateY(8px) rotate(45deg)";
            (lines[1] as HTMLElement).style.opacity = "0";
            (lines[2] as HTMLElement).style.transform =
                "translateY(-8px) rotate(-45deg)";
        } else {
            (lines[0] as HTMLElement).style.transform = "none";
            (lines[1] as HTMLElement).style.opacity = "1";
            (lines[2] as HTMLElement).style.transform = "none";
        }
    });

    // Cerrar menú al hacer click en un link
    mobileMenu.querySelectorAll("a").forEach((link) => {
        link.addEventListener("click", () => {
            open = false;
            mobileMenu.classList.add("hidden");
            (lines[0] as HTMLElement).style.transform = "none";
            (lines[1] as HTMLElement).style.opacity = "1";
            (lines[2] as HTMLElement).style.transform = "none";
        });
    });
</script>
