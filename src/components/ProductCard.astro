---
import type { Product, Config } from "../types";

interface Props {
    product: Product;
    config: Config;
}

const { product, config } = Astro.props;

const hasOffer = !!product.precio_oferta;
const isNew = product.novedad?.toLowerCase() === "si";
const badge = hasOffer ? "OFERTA" : isNew ? "NUEVO" : null;
---

<div
    class="product-card cursor-pointer group"
    data-product={JSON.stringify(product)}
    data-cat={product.categoria}
>
    <!-- Imagen -->
    <div
        class="relative rounded-2xl overflow-hidden mb-4"
        style="aspect-ratio: 3/4; background: var(--bg-card);"
    >
        {
            product.imagen ? (
                <img
                    src={product.imagen}
                    alt={product.nombre}
                    class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                />
            ) : (
                <div class="w-full h-full flex items-center justify-center text-5xl">
                    ðŸ“¦
                </div>
            )
        }

        <!-- Badge -->
        {
            badge && (
                <span
                    class="absolute top-3 left-3 text-xs font-bold px-3 py-1 rounded-full"
                    style="background: #111; color: #fff; letter-spacing: 0.08em;"
                >
                    {badge}
                </span>
            )
        }
    </div>

    <!-- Info -->
    <div>
        <h3
            class="font-bold leading-tight mb-1"
            style="font-family: var(--font-display); font-size: clamp(1.2rem, 2vw, 1.6rem); letter-spacing: 0.03em; color: var(--text);"
        >
            {product.nombre}
        </h3>
        {
            product.descripcion && (
                <p
                    class="text-sm mb-3 line-clamp-2 leading-relaxed"
                    style="color: var(--text-muted);"
                >
                    {product.descripcion}
                </p>
            )
        }
        <div class="flex items-center gap-3">
            {
                hasOffer ? (
                    <>
                        <span
                            class="font-bold text-lg"
                            style="color: var(--text);"
                        >
                            {config.moneda}
                            {Number(product.precio_oferta).toLocaleString()}
                        </span>
                        <span
                            class="text-sm line-through"
                            style="color: var(--text-muted);"
                        >
                            {config.moneda}
                            {Number(product.precio).toLocaleString()}
                        </span>
                    </>
                ) : (
                    <span class="font-bold text-lg" style="color: var(--text);">
                        {config.moneda}
                        {Number(product.precio).toLocaleString()}
                    </span>
                )
            }
        </div>
    </div>
</div>
